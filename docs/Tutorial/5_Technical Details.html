<h1>Technical Details</h1><p>For those who like some more background, we will dive into some technical details of Magritte and QCMagritte. This is an optional chapter, that will make it easier to follow the rest of the tutorial.</p><h2>Smalltalk background</h2><p>I probably should start to some of the properties of smalltalk here, as well as of Seaside. Important tools are the debugger, refactoring possibilities, preserving state, adding libraries and such. There are already quite a few good tutorials on these topics. So I will skip this for new.</p><div><p>I personally liked the tutorial of Seaside done by James Foster (http://seaside.gemtalksystems.com/tutorial.html) best. This is a very good tutorial that explains such concepts.<br/></p></div><h2>Descriptions</h2><p>A typical magritte-description has a type (implicit), accessor, label and priority.</p><div><p class="code">descriptionCompleted<br/>	&lt;magritteDescription&gt;<br/>	^MABooleanDescription new<br/>		accessor: #completed;<br/>		label: 'Completed';<br/>		priority: 300;<br/>		beReadonly;<br/>		yourself<br/></p><p>The first line is a so-called pragma, allowing the magritte framework to know it needs to proces the method as a description.<br/></p><p>The type of this variable is a &quot;boolean&quot;, thus a MABooleanDescription is returned. The boolean can be accessed by using the accessor method completed (and implicit the setter is set to completed:). When displayed it should be labeld &quot;Completed&quot; and the priority is 300.<br/></p><p>The priority determines where it is displayed. Why don't you try modifying the priority to &quot;-1&quot; to see the result.<br/></p><p>The last setting that is made in the description is &quot;readonly&quot;, stating it can only be read, and the setter should not be called.<br/></p></div><h2>Boolean description</h2><p>Let's take this boolean description as a start-point to dive in deeper into the framework. Select the classname &quot;MABooleanDescription&quot; by double clicking it, and press crtl-B (Or cmd-B on a mac) to browse this class.</p><div><p>Please note the following method:<br/></p><p class="code">labelForOption: anObject<br/>	anObject == true<br/>		ifTrue: [ ^ self trueString ].<br/>	anObject == false<br/>		ifTrue: [ ^ self falseString ].<br/>	^ self undefined<br/></p><p>This method clearly is the central object that determines how this object is displayed. When you follow the local implementations you will notice that all defaults are on the class side and can be overridden by setting properties. These properties all have accesser methods, and description that describe how they behave (with default and all).<br/></p><p>Now go back to the method &quot;descriptionCompleted&quot; and select the entire statement that returns the boolean description. Press crtl-I to open an inspector on this object. Note that all properties like priority and readonly are set in a dictionary &quot;properties&quot;. This mechanism allows the framework to be extended easily by things not native to magritte, such as magritte-seaside.<br/></p><p>Finally, type &quot;self magritteDescription&quot; in the left bottom pane of the inspector, select this and inspect. It will now open an inspector on the magritte description of the boolean description. It gives you a list of all properties that can be set, with default values and such. You will find that most Magritte classes are documented using Magritte.<br/></p></div><h2>Defaults</h2><p>The default values of Magritte can be found on the class side of each class. As we have seen, we have a default for the boolean for the &quot;true&quot; and the &quot;false&quot;.</p><div><p>Let's make our description more accurate stating that for completed we need a &quot;yes&quot; and a &quot;no&quot; instead of a &quot;true&quot; and a &quot;false&quot;. Add the following property lines to the description:<br/></p><p class="code">		trueString: 'yes';<br/>		falseString: 'no';<br/></p><p>Now start a new session and see that all items now have a nice desciption.<br/></p><p>We furthermore want the description only to be shown when it is already set. We do this by inserting a precondition in the descriptionCompleted. When the title is not set properly: return nil.<br/></p><p>Now go and look at the result by adding another todo-item. And then look at the details. The new todo item should no longer have a &quot;completed&quot; property, while an existing todo item has.<br/></p><p>Unfortunately this also removes the &quot;completed&quot; from the list. Since we now want to learn about the technical details of Magritte, and not yet QC Magritte, I give the fix here without much explanation. We need to set a defaultMagritteTemplate to the TodoItemClass, using following code.<br/></p><p class="code">defaultMagritteTemplate<br/>	^self new<br/>		title: 'template';<br/>		yourself<br/></p><p>Before this takes in effect, we also need to reset the default template using: &quot;TodoItem resetDefaultTemplate.<br/></p></div><h2>Using components</h2><p>For the boolean description you can find another default in the method &quot;defaultComponentClasses&quot; in the categorie &quot;*magritte-seaside-defaults&quot;, indicating that this default is in an extension for Seaside. It determines the default components that can be used to display this object using seaside.</p><div><p class="code">defaultComponentClasses<br/>	^ Array with: MACheckboxComponent with: MASelectListComponent with: MARadioGroupComponent<br/></p><p>It actually lists 3 default classes that can be used to display a boolean. The first is used when nothing else is configured. Let's try out setting the component class. First browse the senders and note that there is a description that uses the defaultComponentClasses as the valid options to select from. To experiment with this component class, add a new boolean description &quot;priority&quot;.<br/></p><p class="code">descriptionPriority<br/>	&lt;magritteDescription&gt;<br/>	^MABooleanDescription new<br/>		accessor: #priority;<br/>		label: 'Priority';<br/>		trueString: 'high';<br/>		falseString: 'low';<br/>		priority: 350;<br/>		componentClass: MARadioGroupComponent;<br/>		yourself<br/></p><p>Don't forget to add accessors and give it a try starting a new session. You should see that this boolean is rendered differently. This allows you to also use a custom (sub)class to render the component exactly how it should be rendered.<br/></p></div><h2>Builders</h2><p>Following the guideline, make it work, make it right, make it fast, the code now needs to be made right, because for a number of reasons the code &quot;componentClass: MARadioButtonComponent&quot; does not belong there.</p><div><p>First of all it breaks our nice domain model, and pollutes it with display code. This only works if I display the thing with Seaside. So for making it work this is fine, but not in your final code.<br/></p><p>Secondly, you usually want to use the same component for displaying a boolean. Having to add this code for all boolean descriptions is code duplication, with all disadvantages of code duplication.<br/></p><p>So we are going to clean this code up, by using a builder. First we need to define a builder class. This builder class belongs in the web-part, so we define our builder-class as follows:<br/></p><p class="code">MADescriptionBuilder subclass: #TodoListBuilder<br/>	instanceVariableNames: ''<br/>	classVariableNames: ''<br/>	package: 'Tutorial-Web'<br/></p><p>This builder belongs in the subpackage &quot;web&quot; as it determines how things look. Now we need to install this builder in the model. We use as a category &quot;*Tutorial-Web&quot; to indicate it is an extension method and belongs in the package &quot;Web&quot;.<br/></p><p class="code">tutorialBuilder: aCollection<br/>	&lt;magritteBuilder&gt;<br/>	aCollection add: TodoListBuilder<br/></p><p>Now finally we need to implement the converter. Don't forget to add a super call, since we do not want to break the visitor, visiting all nodes.<br/></p><p class="code">visitBooleanDescription: aBooleanDescription<br/>	aBooleanDescription componentClass: MARadioGroupComponent.<br/>	super visitBooleanDescription: aBooleanDescription<br/></p><p>Remove the original componentClass: call in the description, and see the radiogroup is still inserted.<br/></p></div>